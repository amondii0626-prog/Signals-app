<!doctype html>
<html lang="mn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trading Signals</title>
  <style>
    :root{color-scheme:dark}
    html,body{margin:0;height:100%;background:#0b0f14;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    #wrap{position:relative;min-height:100vh}
    #panel{
      width:min(720px, calc(100% - 24px));
      margin: 18px auto;
      background:rgba(16,22,30,.92);
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      padding:14px;
      backdrop-filter: blur(8px);
      box-sizing:border-box;
    }
    h1{margin:0 0 12px 0;font-size:28px;display:flex;gap:10px;align-items:center}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    label{opacity:.75;font-size:13px;margin-left:6px}
    input,select,button{
      background:#121a24;color:#fff;border:1px solid rgba(255,255,255,.10);
      border-radius:14px;padding:12px 12px;font-size:16px;outline:none
    }
    input{flex:1;min-width:260px}
    select{min-width:160px}
    button{min-width:140px;font-weight:800;cursor:pointer}
    button:disabled{opacity:.55;cursor:not-allowed}
    #hint{opacity:.85;margin:10px 2px 0 2px;line-height:1.35}
    #out{
      margin-top:12px;
      padding:12px;border-radius:14px;
      background:#0c1320;border:1px solid rgba(255,255,255,.08);
      white-space:pre-wrap;word-break:break-word;
      min-height:54px
    }
    .ok{color:#7CFF9B}
    .bad{color:#FF7C7C}
    .warn{color:#FFD27C}
    .small{opacity:.7;font-size:13px}
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      font-size:12px;
      opacity:.85;
    }
  </style>
  <link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#0b0f14" />
<link rel="apple-touch-icon" href="icon-192.png" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
</head>
<body>
  <div id="wrap">
    <div id="panel">
      <h1>üìä Trading Signals</h1>

      <div class="small" style="margin-bottom:6px">
        <span class="pill" id="jsStatus">JS: loading...</span>
      </div>

      <div class="row" style="margin-bottom:10px">
        <input id="api" placeholder="https://signals-backend-xxxx.onrender.com" />
      </div>

      <div class="row" style="margin-bottom:10px">
        <div style="display:flex;flex-direction:column;gap:6px">
          <label>Symbol</label>
          <select id="pair"></select>
        </div>

        <div style="display:flex;flex-direction:column;gap:6px">
          <label>Timeframe</label>
          <select id="tf"></select>
        </div>

        <button id="btnLoad">Load</button>
        <button id="btnAnalyze">Analyze</button>
      </div>

      <div id="hint">
        ‚úÖ Load –¥–∞—Ä—Å–Ω—ã –¥–∞—Ä–∞–∞ Analyze —Ö–∏–π–Ω—ç.<br/>
        ‚è≥ Render Free –¥—ç—ç—Ä backend —É–Ω—Ç–∞—Ä—Å–∞–Ω –±–∞–π–≤–∞–ª —ç—Ö–Ω–∏–π request ~50 —Å–µ–∫ —É–¥–∞–∞—à–∏—Ä—á –±–æ–ª–Ω–æ.
      </div>

      <div id="out">Ready.</div>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const FALLBACK_SYMBOLS = ["XAUUSD","XAGUSD","BTCUSD","EURUSD","GBPUSD","USDJPY"];
  const FALLBACK_TF = ["5m","15m","30m","1h","4h","1d"];

  let backend = "";

  function setOut(msg, cls="") {
    const el = $("out");
    el.className = cls;
    el.textContent = msg;
  }

  function fillSelect(el, items, fallback) {
    el.innerHTML = "";
    const arr = (Array.isArray(items) && items.length) ? items : fallback;
    for (const v of arr) {
      const opt = document.createElement("option");
      opt.value = v;
      opt.textContent = v;
      el.appendChild(opt);
    }
  }

  function normalizeBackendUrl(raw) {
    let u = (raw || "").trim();

    // –∑–∞—Ä–∏–º —É—Ç–∞—Å–Ω–∞–∞—Å —Å–∞–Ω–∞–º—Å–∞—Ä–≥“Ø–π "(" –æ—Ä–æ–æ–¥ –±–∞–π–¥–∞–≥ ‚Äì —Ü—ç–≤—ç—Ä–ª—ç–Ω—ç
    u = u.replace(/\s+/g, "");
    u = u.replace(/[()]/g, "");

    if (u && !/^https?:\/\//i.test(u)) u = "https://" + u;
    u = u.replace(/\/+$/, "");

    if (!u) throw new Error("Backend URL —Ö–æ–æ—Å–æ–Ω –±–∞–π–Ω–∞.");

    // –±—É—Ä—É—É –¥–æ–º—ç–π–Ω“Ø“Ø–¥–∏–π–≥ –±–∞—Ä–∏–Ω–∞
    if (u.includes(".onrender.con")) {
      throw new Error("‚ùå Backend URL –±—É—Ä—É—É –±–∞–π–Ω–∞: '.con' –±–∏—à '.com' –±–∞–π—Ö —ë—Å—Ç–æ–π.\n‚úÖ –ñ–∏—à—ç—ç: https://signals-backend-su0a.onrender.com");
    }
    if (u.includes(".onrender.cc")) {
      throw new Error("‚ùå Backend URL –±—É—Ä—É—É –±–∞–π–Ω–∞: '.cc' –±–∏—à '.com' –±–∞–π—Ö —ë—Å—Ç–æ–π.\n‚úÖ –ñ–∏—à—ç—ç: https://signals-backend-su0a.onrender.com");
    }
    // —Ö–∞–º–≥–∏–π–Ω –±–∞–≥–∞ —à–∞–ª–≥–∞–ª—Ç
    if (!u.includes(".onrender.com")) {
      // ”©”©—Ä –¥–æ–º—ç–π–Ω –±–∞–π–∂ –±–æ–ª–Ω–æ, –≥—ç—Ö–¥—ç—ç —Ö–∞–º–≥–∏–π–Ω –±–∞–≥–∞ –∑”©–≤–ª”©–º–∂ ”©–≥—å–µ
      // throw —Ö–∏–π—Ö–≥“Ø–π, –∑”©–≤—Ö”©–Ω –∞–Ω—Ö–∞–∞—Ä—É—É–ª–Ω–∞
    }
    return u;
  }

  async function fetchJson(url, timeoutMs = 60000) {
    const ctrl = new AbortController();
    const t = setTimeout(() => ctrl.abort(), timeoutMs);

    try {
      const res = await fetch(url, {
        method: "GET",
        headers: { "Accept": "application/json" },
        signal: ctrl.signal,
      });

      const text = await res.text();
      let data = null;
      try { data = text ? JSON.parse(text) : null; } catch {}

      if (!res.ok) {
        const detail = data ? JSON.stringify(data, null, 2) : text;
        throw new Error(`HTTP ${res.status} ${res.statusText}\n${detail}`);
      }
      return data ?? {};
    } finally {
      clearTimeout(t);
    }
  }

  async function loadBackend() {
    $("btnLoad").disabled = true;
    $("btnAnalyze").disabled = true;

    try {
      backend = normalizeBackendUrl($("api").value);
      setOut("‚è≥ Backend metadata —É–Ω—à–∏–∂ –±–∞–π–Ω–∞...\n(—ç—Ö–Ω–∏–π —É–¥–∞–∞ 10‚Äì50 —Å–µ–∫ –±–∞–π–∂ –±–æ–ª–Ω–æ)", "warn");

      const meta = await fetchJson(`${backend}/`, 65000);

      const symbols = meta.supported_symbols || meta.symbols || [];
      const tfs = meta.supported_timeframes || meta.timeframes || [];

      fillSelect($("pair"), symbols, FALLBACK_SYMBOLS);
      fillSelect($("tf"), tfs, FALLBACK_TF);

      setOut("‚úÖ Loaded backend metadata.\n–û–¥–æ–æ Analyze –¥–∞—Ä.", "ok");
      $("btnAnalyze").disabled = false;
    } catch (e) {
      setOut("‚ùå Load –∞–º–∂–∏–ª—Ç–≥“Ø–π.\n\n" + (e?.message || String(e)), "bad");
    } finally {
      $("btnLoad").disabled = false;
    }
  }

  async function askAnalysis() {
    $("btnAnalyze").disabled = true;

    try {
      if (!backend) backend = normalizeBackendUrl($("api").value);

      const symbol = $("pair").value || "XAUUSD";
      const tf = $("tf").value || "15m";

      setOut(`‚è≥ Analyze —Ö–∏–π–∂ –±–∞–π–Ω–∞...\n${backend}/analyze?symbol=${encodeURIComponent(symbol)}&tf=${encodeURIComponent(tf)}`, "warn");

      const data = await fetchJson(`${backend}/analyze?symbol=${encodeURIComponent(symbol)}&tf=${encodeURIComponent(tf)}`, 65000);

      setOut("‚úÖ Result:\n" + JSON.stringify(data, null, 2), "ok");
    } catch (e) {
      setOut("‚ùå Analyze –∞–º–∂–∏–ª—Ç–≥“Ø–π.\n\n" + (e?.message || String(e)), "bad");
    } finally {
      $("btnAnalyze").disabled = false;
    }
  }

  // Init UI
  fillSelect($("pair"), FALLBACK_SYMBOLS, FALLBACK_SYMBOLS);
  fillSelect($("tf"), FALLBACK_TF, FALLBACK_TF);

  $("btnLoad").addEventListener("click", loadBackend);
  $("btnAnalyze").addEventListener("click", askAnalysis);

  // JS –∞–∂–∏–ª–ª–∞–∂ —ç—Ö—ç–ª—Å–Ω–∏–π–≥ UI –¥—ç—ç—Ä —Ö–∞—Ä—É—É–ª–Ω–∞
  $("jsStatus").textContent = "JS: ‚úÖ loaded";
})();
</script>

</body>
</html>
